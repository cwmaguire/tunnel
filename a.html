<!DOCTYPE html>
<html>

    <head>
        <script language="JavaScript">
            function logFrame(frame){
                var newDiv = document.createElement("div");
                newDiv.innerText = frame.x1 + ", " +
                                   frame.y1 + ", " +
                                   frame.x2 + ", " +
                                   frame.y2 + ", " +
                                   frame.xOrY + ", " +
                                   frame.foregroundColours + ", " +
                                   frame.backgroundColours;
                document.body.appendChild(newDiv);
            }

            function chain(times, fn, object){
                logFrame(object);

                if(times > 0){
                    window.setTimeout(function(){chain(times - 1, fn, fn.call(null, object))}, 100);
                }
            }

            function onLoad(){
                chain(40, draw, {x1: 20,
                                 y1: 20,
                                 x2: 0,
                                 y2: 0,
                                 xOrY: "x",
                                 foregroundColours: ["#FF0000", "#00FF00", "#0000FF", "#FFF0F0"],
                                 backgroundColours: ["#879090", "#879090", "#909090", "#909090", "#879090", "#879090", "#909090", "#909090"],
                                 rectangleMargins: [10, 90],
                                 rectangleMarginDelta: 10});
            }

            function draw(frame){
                return drawFrame(nextFrame(frame));
            }

            function nextFrame(frame){
                frame.foregroundColours.push(frame.foregroundColours.shift()); // rotate the colours
                frame.backgroundColours.push(frame.backgroundColours.shift()); // rotate the colours
                frame.x1 = frame.x2;
                frame.y1 = frame.y2;

                frame.rectangleMargins[0] = (frame.rectangleMargins[0] + frame.rectangleMarginDelta) % 190
                frame.rectangleMargins[1] = (frame.rectangleMargins[1] + frame.rectangleMarginDelta) % 190

                if(frame.xOrY == "x"){
                    frame.x2 = frame.x1 + 20;
                    frame.xOrY = "y";
                }else{
                    frame.y2 = frame.y1 + 20;
                    frame.xOrY = "x";
                }
                return frame;
            }

            function drawFrame(frame){
                var rect1Margin = frame.rectangleMargins[0];
                var rect2Margin = frame.rectangleMargins[1];

                var canvas1 = document.getElementById("canvas1");
                var context1 = canvas1.getContext("2d");
                context1.fillStyle = frame.backgroundColours[0];
                context1.fillRect(0, 0, 400, 400);
                context1.fill();

                context1.strokeStyle = frame.foregroundColours[0];

                context1.strokeRect(200 - rect1Margin,
                                    200 - rect1Margin,
                                    2 * rect1Margin,
                                    2 * rect1Margin);
                context1.strokeRect(200 - rect2Margin,
                                    200 - rect2Margin,
                                    2 * rect2Margin,
                                    2 * rect2Margin);

                context1.beginPath();
                context1.moveTo(200 - rect1Margin, 200 - rect1Margin);
                context1.lineTo(200 - rect2Margin, 200 - rect2Margin);
                context1.moveTo(200 - rect1Margin, 200 + rect1Margin);
                context1.lineTo(200 - rect2Margin, 200 + rect2Margin);
                context1.stroke();
                context1.closePath();
                return frame;
            }
        </script>
    </head>
    <body onload="onLoad()">
        <canvas id="canvas1" width="400" height="400" style="border:1px solid black;"></canvas>
    </body>
</html>